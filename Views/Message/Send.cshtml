@model SendMessageViewModel

@{
    ViewData["Title"] = "Send Message";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - TraadeSphere_vrund</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" />
</head>
<body>
    <div class="container py-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h2 class="mb-0">
                            @if (ViewBag.IsReply == true)
                            {
                                <span>Reply to Message</span>
                            }
                            else
                            {
                                <span>Send Message</span>
                            }
                        </h2>
                    </div>
                    <div class="card-body">
                        @if (ViewBag.IsReply == true && ViewBag.OriginalMessage != null)
                        {
                            <div class="alert alert-info mb-3">
                                <h6>Replying to:</h6>
                                <small class="text-muted">@ViewBag.OriginalMessage.SentDate.ToString("dd/MM/yyyy HH:mm")</small>
                                <p class="mb-0 mt-1"><em>"@ViewBag.OriginalMessage.Content"</em></p>
                            </div>
                        }
                        
                        <form method="post" asp-action="Send">
                            @Html.AntiForgeryToken()
                            
                            @if (!ViewData.ModelState.IsValid)
                            {
                                <div class="alert alert-danger">
                                    <ul class="mb-0">
                                        @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                                        {
                                            <li>@error.ErrorMessage</li>
                                        }
                                    </ul>
                                </div>
                            }
                            
                            <div class="mb-3">
                                <label asp-for="ReceiverId" class="form-label">Select Receiver</label>
                                @if (Model.ReceiverId > 0 && !string.IsNullOrEmpty(Model.ReceiverName))
                                {
                                    <input asp-for="ReceiverId" type="hidden" />
                                    <div class="form-control" readonly>@Model.ReceiverName</div>
                                    <small class="form-text text-success">Messaging: @Model.ReceiverName (ID: @Model.ReceiverId)</small>
                                }
                                else
                                {
                                    <select asp-for="ReceiverId" class="form-select" required>
                                        <option value="">-- Select a trader to message --</option>
                                        @if (ViewBag.Traders != null)
                                        {
                                            @foreach (TraderSelectionDto trader in ViewBag.Traders)
                                            {
                                                <option value="@trader.TraderId">@trader.Name (ID: @trader.TraderId)</option>
                                            }
                                        }
                                    </select>
                                    <small class="form-text text-muted">Choose the trader you want to send a message to</small>
                                }
                                <span asp-validation-for="ReceiverId" class="text-danger"></span>
                            </div>
                            
                            <div class="mb-3">
                                <label asp-for="Content" class="form-label">Message</label>
                                <textarea asp-for="Content" class="form-control" rows="5" required placeholder="Type your message here..."></textarea>
                                <span asp-validation-for="Content" class="text-danger"></span>
                            </div>
                            
                            <div class="d-flex justify-content-between">
                                <a href="@Url.Action("Index", "Message")" class="btn btn-secondary">Cancel</a>
                                <button type="submit" class="btn btn-primary" >Send Message</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
</body>
</html>
